# 域名



域名解析使得公司的dns能区别出
云内网（如公司k8s或者其他服务之间的相互调用）
办公网解析（公司网络postman或者浏览器访问服务）
公网解析（外网访问服务，需要将访问域名解析到弹性IP并将弹性IP NAT到ingress gateway组VIP）
办公网和公网能使用同一个域名是为了能同个域名同时实现全网访问


ingress 多封装了一层k8s网关，使得请求到达k8s能负载均衡以及校验对应的域名和接口是否能访问，能访问则转发到对应的k8s
服务器内部访问：对应“云内网解析”，将访问域名解析到ingress gateway组VIP。
web访问：对应“办公网访问解析”或“公网解析”，“办公网访问解析”将访问域名解析到ingress gateway组VIP，“公网解析”将访问域名解析到弹性IP并将弹性IP NAT到ingress gateway组VIP。

而一个ingress的web 访问只能对应一个域名，因此一个前端部署单元里面若是打包了两个前端服务的代码，需要两个域名分开使用，则需要分别创建两个ingress对应两个域名

是dmz的ingress不能访问dcn的部署单元，还是dmz的前端部署单元不能访问dcn的后端部署单元，为什么会说dmz不能访问dcn？
而k8s和service、ingress的创建都是依赖于集群的如k8s-prd-dmz-share03，创建的service绑定对应的k8s部署单元或者创建ingress绑定对应的service都需要在同一个集群中，因此关联的三者是同时在dmz或者dcn，所以ingress转发的一定是同种vpc的service

dmz的nginx部署单元是能访问部署在dcn 的后台服务的，不需要再额外的配置



因此说生产dmz不能访问dcn，是公网的请求只能由dns解析到dmz区去匹配相应ingressgateVIP（所有提供面向外网的服务，域名对应的ip都是需要单独申请的弹性ip，再有nat服务转发到对应的dmz区的ingress）
而云内网或者办公网的只能解析到dcn区，再去匹配在dcn类型的集群的ingressgateVIP（若是服务只部署在dmz区，而又需要在办公网访问，则可以将办公网的域名解析成弹性ip再由nat转到dmz区的ingress）
而一个域名只能被一个ingress绑定，因此若是要开通全网只能将服务部署在dmz区，然后办公网域名绑定弹性ip
而测试环境请求解析后会直接dmz和dcn两个都查询

请求到达公司的防火墙，首先会区分请求端是外网地址还是内网地址，外网转公网解析，内网转办公网/云内网解析
再区分是生产环境还是测试环境，测试环境无论是外网还是办公网/云内网，都直接在所有测试dmz/dcn区找寻是否由匹配的ip，
而生产环境公网会由弹性ip转到生产dmz区找寻匹配的ip，办公网/云内网解析会去dcn区匹配
同个集群的部署单元可以直接通过对应的service ip去访问对应的服务（被访问的服务允许）、
同种vpc不同集群的访问逻辑同上
不同vpc的集群的部署单元，比如在dmz的nginx服务访问在dcn区的jetty服务，可能是开通service ip 的时候就在防火墙开了白名单，也可能有单向规则，暂时不清楚

# 业务架构



